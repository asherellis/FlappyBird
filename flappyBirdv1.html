<!DOCTYPE html>
<html>
   <head>
      <style>
         canvas {
         border:1px solid black;
         background-image: url("flappyback.png");
         background-size: 100%; height: 95%
         }
         #qwerty{
         font-family: Arial;
         }
      </style>
   </head>
   <body onload="startGame()">
      <p id="qwerty">
      </p>
      <p id = "scoreTracker2"> </p>
      <script>
         var myObstacles = [];
         var myScore = 0;
         var numbObstaclePast = 0;
         var running = true;
         var timeOfLastJump = 0;
         var wantsToJump=false;
         var updateVersion;

         function doMouseDown(event){
           page_x = event.pageX;
           page_y = event.pageY;

           if(page_x>173 & page_x<247 & page_y > 151 & page_y<175){
             window.location.reload(false);
          }
          else if(page_x>254 & page_x<324 & page_y > 151 & page_y<175){
            var url = "https://twitter.com/intent/tweet/?text=Just%20scored%20" + myScore + "%20points!";
            window.open(url);
          }
          else if(page_x>175 & page_x<327 & page_y > 183 & page_y<201){
            window.location.reload(false);
            //WHEN YOU CLICK ADD TO LEADERBOARD BUTTON!!!
          }

         }

         function checkIfRunning(){
           if(running == false){
             ctx.font = "14px Verdana";
             ctx.fillStyle="rgb(255, 204, 102)";
             ctx.fillRect(195,20,80,100);
             ctx.strokeRect(195,20,80,100);
             ctx.fillStyle = "white";
             ctx.fillText(myScore, 230, 70);
             ctx.strokeText(myScore, 230, 70);
             ctx.fillText(highScore, 225, 110);
             ctx.strokeText(highScore, 225, 110);
             ctx.fillStyle = "red";
             ctx.fillText("SCORE", 210, 50);
             ctx.fillText("BEST", 216, 90);
             ctx.fillStyle = "red";
             ctx.fillRect(165,140,70,20);
             ctx.strokeRect(165,140,70,20);
             ctx.fillRect(245,140,70,20);
             ctx.strokeRect(245,140,70,20);
             ctx.fillStyle = "white";
             ctx.fillText("RESTART", 167, 155);
             ctx.fillText("SHARE", 255, 155);
             ctx.fillStyle = "red";
             ctx.fillRect(165,170,150,20);
             ctx.strokeRect(165,170,150,20);
             ctx.fillStyle = "white";
             ctx.font = "12px Verdana";
             ctx.fillText("ADD TO LEADERBOARD", 168, 185);
             myGamePiece = new component(34, 24, "flappy2.png", 170, 246, "image");
             var updateVersion = 0;
             myGamePiece.update();

           }
         }

         if(running == true){
          function startGame() {
            myGamePiece = new component(34, 24, "spritesheet.png", 170, 120, "sprite");
            myGamePiece.gravity = 0.15;
            myGameArea.start();
          }
         var myGameArea = {
             canvas : document.createElement("canvas"),
             start : function() {
                 this.canvas.width = 480;
                 this.canvas.height = 270;
                 this.context = this.canvas.getContext("2d");
                 document.body.insertBefore(this.canvas, document.body.childNodes[0]);
                 this.frameNo = 0;
                 this.interval = setInterval(updateGameArea, 20);
                 this.interval = setInterval(checkIfRunning, 20);
                 },
             clear : function() {
                 this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
             }
         }

         var speed = 2;
         var canvas = document.getElementById("myCanvas");
         var spritesheet = new Image();
         spritesheet.src = "spritesheet.png";
         var imageWidth = 34, imageHeight = 24;
         var numbImages = 4;
         var currImage = 0;

         function clearBackground() {
          ctx.fillRect( 0, 0, 480, 270);
         }


         function component(width, height, color, x, y, type) {
             this.type = type;
             this.score = 0;
             this.width = width;
             this.height = height;
             this.speedY = 0;
             this.x = x;
             this.y = y;
             this.gravity = 0;
             this.gravitySpeed = 0;
             flySound = document.createElement("audio");
             flySound.src = "fly.mp3";
             scoreSound = document.createElement("audio");
             scoreSound.src = "score.mp3";

             if (type == "image") {
               this.image = new Image();
               this.image.src = color;
             }

             ctx = myGameArea.context;
             this.update = function() {
               if (updateVersion == 1){
               ctx.fillStyle = "white";
               ctx.fillText(myScore, 240, 80);
               ctx.strokeText(myScore, 240, 80);
               ctx.font = "28px Verdana";
         }
                 if (type == "image") {
                  ctx.drawImage(this.image, this.x, this.y, this.width, this.height);

                   ctx.fillStyle = "rgba(255, 255, 255, 0)";
                   ctx.globalCompositeOperation = 'source-over';
                 }
                 else if (type == "sprite"){
                   ctx.drawImage( spritesheet, currImage*imageWidth-.5 , 0, imageWidth, imageHeight, this.x, this.y, imageWidth, imageHeight );
                   if(everyinterval(5)){
                     currImage+=1;
                     currImage %= numbImages;
                   }

                 }
                 else {
                   ctx.fillStyle = color;
                   ctx.fillRect(this.x, this.y, this.width, this.height);
                 }
               }


             this.newPos = function() {
                 this.gravitySpeed += this.gravity;
                 this.y += this.speedY + this.gravitySpeed;
                 this.hitBottom();
                 if(numbObstaclePast>2){
                   if (everyinterval(150)) {
                       this.hitTop();
                   }
                 }
             }
             this.hitBottom = function() {
                 var rockbottom = myGameArea.canvas.height - this.height;
                 if (this.y > rockbottom) {
                   running = false;
                  }
             }
             this.hitTop = function() {
               var top = 0
               if(this.y < top){
                 running = false;
               }
             }

             this.crashWith = function(otherobj) {
                 var myleft = this.x;
                 var myright = this.x + (this.width);
                 var mytop = this.y;
                 var mybottom = this.y + (this.height);
                 var otherleft = otherobj.x;
                 var otherright = otherobj.x + (otherobj.width);
                 var othertop = otherobj.y;
                 var otherbottom = otherobj.y + (otherobj.height);
                 var crash = true;
                 if ((mybottom < othertop) || (mytop > otherbottom) || (myright < otherleft) || (myleft > otherright)) {
                     crash = false;
                 }
                 return crash;
             }
         }

         function updateGameArea() {
             var x, height, gap, minHeight, maxHeight, gap;
             for (i = 0; i < myObstacles.length; i += 1) {
                 if (myGamePiece.crashWith(myObstacles[i])) {
                   running = false;
                 }
             }
             myGameArea.clear();
             myGameArea.frameNo += 1;
             if (myGameArea.frameNo == 1 || everyinterval(150)) {
                 x = myGameArea.canvas.width;
                 minHeight = 20;
                 maxHeight = 180;
                 height = Math.random()*(maxHeight-minHeight)+minHeight;
                 gap = 110;

                 myObstacles.push(new component(27, height, "pipe.png", x, 0, "image"));
                 myObstacles.push(new component(27, x - height - gap, "pipe.png", x, height + gap, "image"));

                 numbObstaclePast+=1;
             }
         if(running==true){
             if(numbObstaclePast<2){
               document.getElementById('qwerty').innerHTML = "Current score: " + myScore + "<br><br>High score: " + highScore;
               document.getElementById('qwerty').innerHTML = "Current score: " + myScore + "<br><br>High score: " + highScore;
             }
             else if(numbObstaclePast>2){
               if (everyinterval(150)) {
                   myScore++;
                   scoreSound.play();
                   document.getElementById('qwerty').innerHTML = "Current score: " + myScore + "<br><br>High score: " + highScore;

                   if(myScore>(highScore-1)){
                     highScore=myScore;
                     localStorage.setItem("highScoreRecord", highScore);
                     document.getElementById('qwerty').innerHTML = "Current score: " + myScore + "<br><br>High score: " + highScore;
                 }
               }

         }

             for (i = 0; i < myObstacles.length; i += 1) {
                 myObstacles[i].x += -1;
                 myObstacles[i].update();
             }
             var updateVersion = 1;
             myGamePiece.newPos();
             myGamePiece.update();
         }
         }
         function everyinterval(n) {
             if ((myGameArea.frameNo / n) % 1 == 0) {
               return true;
             }
             return false;
         }

         function accelerate(n) {
             myGamePiece.gravity = n;
         }
         function changeSpeed(n) {
             myGamePiece.speedY-=n;
         }

         document.addEventListener("keydown", handleKeyDown, true);
         document.addEventListener("keyup", handleKeyUp, true);
         document.addEventListener("mousedown", doMouseDown, true);

         function handleKeyDown(event) {
         if(event.key == ' ') {
           var now = new Date().getTime();

           if(now-timeOfLastJump > 200){
             changeSpeed(7);
             timeOfLastJump=now;
             flySound.play();
          }
           }
         }

         function handleKeyUp(event) {
         if(event.key == ' ') {
         	accelerate(0.25);
           }
         }
         var highScore = JSON.parse(localStorage.getItem("highScoreRecord"));
         if(highScore==null){
           highScore=0;
         }
         }
      </script>
   </body>
</html>
