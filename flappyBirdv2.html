<!DOCTYPE html>
<html>
   <head>
      <style>
         canvas {
         border:1px solid black;
         background-image: url("flappyback.png");
         background-size: 100%; height: 95%
         }
         #qwerty{
         font-family: Arial;
         }

      </style>
   </head>
   <body onload="startGame()">
      <p id="qwerty">
      </p>
      <script>
         var myObstacles = [];
         var myScore = 0;
         var numbObstaclePast = 0;
         var running = true;
         function checkIfRunning(){
           if(running == false){
             window.location.reload(false);
           }
         }

         function startGame() {
            myGamePiece = new component(30, 25, "flappybird.png", 20, 120, "image");
            myGamePiece.gravity = 0.15;
            myGameArea.start();
         }
         var myGameArea = {
             canvas : document.createElement("canvas"),
             start : function() {
                 this.canvas.width = 480;
                 this.canvas.height = 270;
                 this.context = this.canvas.getContext("2d");
                 document.body.insertBefore(this.canvas, document.body.childNodes[0]);
                 this.frameNo = 0;
                 this.interval = setInterval(updateGameArea, 20);
                 this.interval = setInterval(checkIfRunning, 20);
                 },
             clear : function() {
                 this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
             }
         }

         function component(width, height, color, x, y, type) {
             this.type = type;
             this.score = 0;
             this.width = width;
             this.height = height;
             this.speedX = 0;
             this.speedY = 0;
             this.x = x;
             this.y = y;
             this.gravity = 0;
             this.gravitySpeed = 0;
             if (type == "image") {
               this.image = new Image();
               this.image.src = color;
             }

             this.update = function() {
               ctx = myGameArea.context;
                 if (type == "image") {
                   ctx.drawImage(this.image, this.x, this.y, this.width, this.height);

                   //make background of bird transparent
                   ctx.fillStyle = "rgba(255, 255, 255, 0)";
                   ctx.globalCompositeOperation = 'source-over';
                 }
                 else {
                   ctx.fillStyle = color;
                   ctx.fillRect(this.x, this.y, this.width, this.height);
                 }
               }
             this.newPos = function() {
                 this.gravitySpeed += this.gravity;
                 this.x += this.speedX;
                 this.y += this.speedY + this.gravitySpeed;
                 this.hitBottom();
                 if(numbObstaclePast>3){
                   if (everyinterval(150)) {
                       this.hitTop();
                   }
                 }
             }
             this.hitBottom = function() {
                 var rockbottom = myGameArea.canvas.height - this.height;
                 if (this.y > rockbottom) {
                   running = false;
                  }
             }
             this.hitTop = function() {
               var top = 0
               if(this.y < top){
                 running = false;
               }
             }

             this.crashWith = function(otherobj) {
                 var myleft = this.x;
                 var myright = this.x + (this.width);
                 var mytop = this.y;
                 var mybottom = this.y + (this.height);
                 var otherleft = otherobj.x;
                 var otherright = otherobj.x + (otherobj.width);
                 var othertop = otherobj.y;
                 var otherbottom = otherobj.y + (otherobj.height);
                 var crash = true;
                 if ((mybottom < othertop) || (mytop > otherbottom) || (myright < otherleft) || (myleft > otherright)) {
                     crash = false;
                 }
                 return crash;
             }
         }

         function updateGameArea() {
             var x, height, gap, minHeight, maxHeight, gap;
             for (i = 0; i < myObstacles.length; i += 1) {
                 if (myGamePiece.crashWith(myObstacles[i])) {
                   running = false;
                 }
             }
             myGameArea.clear();
             myGameArea.frameNo += 1;
             if (myGameArea.frameNo == 1 || everyinterval(150)) {
                 x = myGameArea.canvas.width;
                 minHeight = 20;
                 maxHeight = 200;
                 height = Math.random()*(maxHeight-minHeight)+minHeight;
                 gap = 110;
                 myObstacles.push(new component(15, height, "toptube.png", x, 0, "image"));
                 myObstacles.push(new component(15, x - height - gap, "bottomtube.png", x, height + gap, "image"));
                 numbObstaclePast+=1;
             }
             if(numbObstaclePast<3){
               document.getElementById('qwerty').innerHTML = "Current score is " + myScore + "<br><br>High score is " + highScore;
             }
             else if(numbObstaclePast>3){
               if (everyinterval(150)) {
                   myScore++;
                   document.getElementById('qwerty').innerHTML = "Current score is " + myScore + "<br><br>High score is " + highScore;
                   if(myScore>(highScore-1)){
                     highScore=myScore;
                     localStorage.setItem("hs", highScore);
                     document.getElementById('qwerty').innerHTML = "Current score is " + myScore + "<br><br>High score is " + highScore;
                 }
               }

         }
             for (i = 0; i < myObstacles.length; i += 1) {
                 myObstacles[i].x += -1;
                 myObstacles[i].update();
             }
             myGamePiece.newPos();
             myGamePiece.update();
         }

         function everyinterval(n) {
             if ((myGameArea.frameNo / n) % 1 == 0) {
               return true;
             }
             return false;
         }

         function accelerate(n) {
             myGamePiece.gravity = n;
         }
         function changeSpeed(n) {
             myGamePiece.speedY+=n;
         }

         document.addEventListener("keydown", handleKeyDown, true);
         document.addEventListener("keyup", handleKeyUp, true);

         function handleKeyDown(event) {
         if(event.key == ' ') {
         	changeSpeed(-7);
           }
         }

         function handleKeyUp(event) {
         if(event.key == ' ') {
         	accelerate(0.25);
           }
         }
         var highScore = JSON.parse(localStorage.getItem("hs"));
         if(highScore==null){
           highScore=0;
         }
      </script>
   </body>
</html>
